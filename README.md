# RPE-Backend

Sistema de Avalia√ß√£o de Desempenho Corporativo (RPE - Review Performance Evaluation)

## üìã Descri√ß√£o

O RPE-Backend √© uma plataforma corporativa de avalia√ß√£o de desempenho desenvolvida em NestJS, que permite gerenciar ciclos de avalia√ß√£o, colaboradores, crit√©rios avaliativos e equaliza√ß√£o de resultados. O sistema suporta m√∫ltiplos tipos de avalia√ß√£o (autoavalia√ß√£o, pares, l√≠der-colaborador, mentor-colaborador) e oferece funcionalidades de IA para auxiliar no processo de equaliza√ß√£o.

## üöÄ Funcionalidades Principais

### üë• Gest√£o de Colaboradores
- Cadastro e gerenciamento de colaboradores
- Sistema de perfis (Colaborador Comum, Gestor, Mentor, L√≠der, RH, Membro do Comit√™, Admin)
- Associa√ß√£o de colaboradores a ciclos de avalia√ß√£o
- Gest√£o de relacionamentos (gestor-colaborador, l√≠der-colaborador, mentor-colaborador, pares)

### üìÖ Ciclos de Avalia√ß√£o
- Cria√ß√£o e gerenciamento de ciclos de avalia√ß√£o
- Controle de status (Agendado, Em Andamento, Em Revis√£o, Em Equaliza√ß√£o, Fechado)
- Configura√ß√£o de dura√ß√µes para cada fase do ciclo
- Hist√≥rico e relat√≥rios de ciclos

### üéØ Crit√©rios Avaliativos
- Defini√ß√£o de crit√©rios com pesos e pilares
- Associa√ß√£o de crit√©rios a ciclos espec√≠ficos
- Categoriza√ß√£o por pilares (Comportamento, Execu√ß√£o, Gest√£o e Lideran√ßa)

### üìä Sistema de Avalia√ß√µes
- **Autoavalia√ß√£o**: Colaborador avalia seu pr√≥prio desempenho
- **Avalia√ß√£o de Pares**: Colegas avaliam uns aos outros
- **Avalia√ß√£o L√≠der-Colaborador**: L√≠deres avaliam seus liderados
- **Avalia√ß√£o Colaborador-Mentor**: Colaboradores avaliam seus mentores
- Controle de status (Pendente, Conclu√≠da)

### ‚öñÔ∏è Equaliza√ß√£o
- Comit√™ de equaliza√ß√£o para revisar avalia√ß√µes
- Ajuste de notas com justificativas
- Gera√ß√£o de "Brutal Facts" (resumos finais)
- Integra√ß√£o com IA para sugest√µes de equaliza√ß√£o

### ü§ñ Intelig√™ncia Artificial
- Assistente de IA para equaliza√ß√£o
- An√°lise de avalia√ß√µes e sugest√µes de ajustes
- Configura√ß√£o personalizada para diferentes contextos

### üìà Relat√≥rios e Analytics (RH)
- Dashboard de progresso por unidade e trilha
- Estat√≠sticas de avalia√ß√µes conclu√≠das
- Relat√≥rios de status por ciclo

### üîÑ Sincroniza√ß√£o
- Integra√ß√£o com sistema ERP
- Sincroniza√ß√£o autom√°tica de colaboradores, projetos e aloca√ß√µes
- Rotina agendada para atualiza√ß√µes

### üìÅ Gest√£o de Projetos
- Cadastro e gerenciamento de projetos
- Aloca√ß√£o de colaboradores em projetos
- Controle de status de projetos

### üîê Autentica√ß√£o e Autoriza√ß√£o
- Sistema JWT para autentica√ß√£o
- Controle de acesso baseado em perfis
- Auditoria de a√ß√µes dos usu√°rios

### üì§ Importa√ß√£o de Dados
- Importa√ß√£o de avalia√ß√µes via arquivos Excel
- Valida√ß√£o e processamento de dados
- Seed autom√°tico de dados de teste
- Scripts SQL para popula√ß√£o inicial do banco

## üõ†Ô∏è Tecnologias Utilizadas

- **Framework**: NestJS 11
- **Banco de Dados**: PostgreSQL 16
- **ORM**: Prisma 6
- **Autentica√ß√£o**: JWT, Passport
- **Valida√ß√£o**: Class-validator, Class-transformer
- **IA**: Google Generative AI
- **Agendamento**: @nestjs/schedule
- **HTTP Client**: Axios
- **Testes**: Jest
- **Linting**: ESLint
- **Formata√ß√£o**: Prettier
- **Git Hooks**: Husky
- **Commits**: Conventional Commits

## üì¶ Pr√©-requisitos

- Node.js 18+
- PostgreSQL 16+
- pnpm (recomendado) ou npm

## üöÄ Instala√ß√£o

1. **Clone o reposit√≥rio**
```bash
git clone <url-do-repositorio>
cd RPE-Backend
```

2. **Instale as depend√™ncias**
```bash
pnpm install
```

3. **Configure as vari√°veis de ambiente**
```bash
cp .env.example .env
```

Edite o arquivo `.env` com suas configura√ß√µes:
```env
# Database
DATABASE_URL="postgresql://user:password@localhost:5432/rpe_db"

# JWT
JWT_SECRET="sua-chave-secreta-jwt"

# PostgreSQL
POSTGRES_USER=postgres
POSTGRES_PASSWORD=sua-senha
POSTGRES_DB=rpe_db

# ERP Integration
ERP_URL=http://localhost:3001

# Google AI
GOOGLE_AI_API_KEY=sua-chave-api-google-ai
```

4. **Configure o banco de dados**
```bash
# Execute as migra√ß√µes
pnpm prisma migrate dev

# Execute o seed (opcional)
pnpm prisma db seed
```

5. **Ative os hooks do Git**
```bash
pnpm prepare
```

**Nota**: Este comando configura o Husky para validar commits seguindo o padr√£o Conventional Commits. Para fazer commits, use `pnpm commit` para o modo interativo ou siga o padr√£o manualmente.

## üèÉ‚Äç‚ôÇÔ∏è Executando o Projeto

### Desenvolvimento
```bash
# Inicia o servidor de desenvolvimento
pnpm start:dev

# Inicia o servidor mock do ERP (opcional)
pnpm start:erp
```

### Produ√ß√£o
```bash
# Build do projeto
pnpm build

# Executa em produ√ß√£o
pnpm start:prod
```

### Docker
```bash
# Executa com Docker Compose
docker-compose up -d
```

## üìö API Endpoints

### üîê Autentica√ß√£o

#### Login
```http
POST /auth/login
Content-Type: application/json

{
  "email": "usuario@empresa.com",
  "senha": "senha123"
}
```

### üë• Colaboradores

#### Criar Colaborador
```http
POST /colaborador/
Authorization: Bearer <token>
Content-Type: application/json

{
  "nomeCompleto": "Jo√£o da Silva",
  "email": "joao.silva@empresa.com",
  "senha": "senha123",
  "cargo": "Desenvolvedor",
  "trilhaCarreira": "Desenvolvimento",
  "unidade": "S√£o Paulo"
}
```

#### Buscar Colaborador
```http
GET /colaborador/get/{id}
Authorization: Bearer <token>
```

#### Atualizar Colaborador
```http
PUT /colaborador/atualizar/{id}
Authorization: Bearer <token>
Content-Type: application/json

{
  "nomeCompleto": "Jo√£o Silva Santos",
  "cargo": "Desenvolvedor Senior"
}
```

#### Remover Colaborador
```http
DELETE /colaborador/{id}
Authorization: Bearer <token>
```

#### Associar Perfil
```http
POST /colaborador/associar-perfil
Authorization: Bearer <token>
Content-Type: application/json

{
  "tipoPerfil": "GESTOR",
  "idColaborador": "uuid-do-colaborador"
}
```

### üìÖ Ciclos de Avalia√ß√£o

#### Criar Ciclo
```http
POST /ciclo
Authorization: Bearer <token>
Content-Type: application/json

{
  "nome": "Ciclo 2025.1",
  "dataInicioAno": 2025,
  "dataInicioMes": 7,
  "dataInicioDia": 1,
  "dataFimAno": 2025,
  "dataFimMes": 7,
  "dataFimDia": 31,
  "duracaoEmAndamentoDias": 10,
  "duracaoEmRevisaoDias": 5,
  "duracaoEmEqualizacaoDias": 3
}
```

#### Buscar Ciclos
```http
GET /ciclo/get-all
Authorization: Bearer <token>

GET /ciclo/get-ativos
Authorization: Bearer <token>

GET /ciclo/get-historico
Authorization: Bearer <token>
```

#### Atualizar Ciclo
```http
PUT /ciclo/{id}
Authorization: Bearer <token>
Content-Type: application/json

{
  "nome": "Ciclo 2025.1 Atualizado",
  "status": "EM_ANDAMENTO"
}
```

### üéØ Crit√©rios

#### Criar Crit√©rio
```http
POST /criterios
Authorization: Bearer <token>
Content-Type: application/json

{
  "nomeCriterio": "Comunica√ß√£o",
  "descricao": "Capacidade de comunica√ß√£o clara e efetiva",
  "peso": 2.5,
  "obrigatorio": true,
  "pilar": "Comportamento"
}
```

#### Associar Crit√©rio ao Ciclo
```http
POST /associacoes-criterio-ciclo
Authorization: Bearer <token>
Content-Type: application/json

{
  "idCiclo": "uuid-do-ciclo",
  "idCriterio": "uuid-do-criterio"
}
```

### üìä Avalia√ß√µes

#### Lan√ßar Avalia√ß√µes
```http
POST /avaliacoes
Authorization: Bearer <token>
Content-Type: application/json

{
  "idCiclo": "uuid-do-ciclo"
}
```

#### Lan√ßar Avalia√ß√µes Espec√≠ficas
```http
POST /avaliacoes/lancar-auto-avaliacoes
POST /avaliacoes/lancar-pares
POST /avaliacoes/lancar-lider-colaborador
POST /avaliacoes/lancar-colaborador-mentor
Authorization: Bearer <token>
Content-Type: application/json

{
  "idCiclo": "uuid-do-ciclo"
}
```

#### Preencher Avalia√ß√£o
```http
POST /avaliacoes/preencher-avaliacao-pares
Authorization: Bearer <token>
Content-Type: application/json

{
  "idAvaliacao": "uuid-da-avaliacao",
  "nota": 4,
  "motivacao": "Concordo",
  "pontosFortes": "Excelente comunica√ß√£o",
  "pontosFracos": "Pode melhorar gest√£o de tempo"
}
```

#### Buscar Avalia√ß√µes
```http
GET /avaliacoes/tipo/usuario/{idUsuario}?tipoAvaliacao=AVALIACAO_PARES
GET /avaliacoes/status/{idCiclo}?status=PENDENTE
Authorization: Bearer <token>
```

### ‚öñÔ∏è Equaliza√ß√£o

#### Buscar Equaliza√ß√µes
```http
GET /equalizacao/ciclo/{idCiclo}
Authorization: Bearer <token>
```

#### Ajustar Nota
```http
POST /equalizacao/ajustar-nota
Authorization: Bearer <token>
Content-Type: application/json

{
  "idEqualizacao": "uuid-da-equalizacao",
  "notaAjustada": 4.5,
  "justificativa": "Ajuste baseado na an√°lise do comit√™"
}
```

### ü§ñ IA

#### Sugest√µes de Equaliza√ß√£o
```http
POST /ia/sugerir-equalizacao
Authorization: Bearer <token>
Content-Type: application/json

{
  "idCiclo": "uuid-do-ciclo",
  "contexto": "Contexto espec√≠fico para an√°lise"
}
```

### üìà Relat√≥rios RH

#### Estat√≠sticas
```http
GET /RH/colaboradores/ciclo/{idCiclo}
GET /RH/avaliacoes/concluidas/ciclo/{idCiclo}
GET /RH/unidades
GET /RH/avaliacoes/status/{idCiclo}
Authorization: Bearer <token>
```

#### Progresso
```http
GET /RH/progresso/unidade/ciclo/{idCiclo}
GET /RH/progresso/trilha/ciclo/{idCiclo}
Authorization: Bearer <token>
```

### üìÅ Projetos

#### Gerenciar Projetos
```http
POST /projetos
GET /projetos
GET /projetos/{id}
PATCH /projetos/{id}
DELETE /projetos/{id}
Authorization: Bearer <token>
```

#### Aloca√ß√µes
```http
POST /projetos/{idProjeto}/alocacoes
GET /projetos/{idProjeto}/alocacoes
PATCH /projetos/alocacoes/{idAlocacao}
DELETE /projetos/alocacoes/{idAlocacao}
Authorization: Bearer <token>
```

### üì§ Importa√ß√£o

#### Importar Avalia√ß√µes
```http
POST /importacao/avaliacoes
Authorization: Bearer <token>
Content-Type: multipart/form-data

file: [arquivo-excel]
```

## üîê Perfis e Permiss√µes

### Tipos de Perfil
- **COLABORADOR_COMUM**: Acesso b√°sico ao sistema
- **GESTOR**: Gerencia equipes e avalia√ß√µes
- **MENTOR**: Acesso a avalia√ß√µes de mentoreados
- **LIDER**: Avalia liderados
- **RH**: Acesso a relat√≥rios e analytics
- **MEMBRO_COMITE**: Participa da equaliza√ß√£o
- **ADMIN**: Acesso total ao sistema

## üß™ Testes

```bash
# Executar testes unit√°rios
pnpm test

# Executar testes em modo watch
pnpm test:watch

# Executar testes com coverage
pnpm test:cov

# Executar testes e2e
pnpm test:e2e
```

## üê≥ Docker

### Build da Imagem
```bash
docker build -t rpe-backend .
```

### Executar com Docker Compose
```bash
docker-compose up -d
```

### Vari√°veis de Ambiente para Docker
```env
DATABASE_URL=postgresql://postgres:password@db:5432/rpe_db
JWT_SECRET=your-jwt-secret
ERP_URL=http://erp-service:3001
GOOGLE_AI_API_KEY=your-google-ai-key
```

### Configura√ß√£o do Dockerfile
O Dockerfile utiliza multi-stage build para otimizar o tamanho da imagem:
- **Stage 1 (Builder)**: Instala depend√™ncias e gera o build
- **Stage 2 (Production)**: Imagem final otimizada com apenas os arquivos necess√°rios
- **Node.js 20.9.0-slim**: Vers√£o LTS otimizada
- **PNPM**: Gerenciador de pacotes mais eficiente
- **Prisma**: Gera√ß√£o autom√°tica do cliente

## üîß Configura√ß√£o de Desenvolvimento

### Estrutura do Projeto
```
src/
‚îú‚îÄ‚îÄ auth/           # Autentica√ß√£o e autoriza√ß√£o
‚îú‚îÄ‚îÄ colaborador/    # Gest√£o de colaboradores
‚îú‚îÄ‚îÄ ciclo/         # Ciclos de avalia√ß√£o
‚îú‚îÄ‚îÄ criterios/     # Crit√©rios avaliativos
‚îú‚îÄ‚îÄ avaliacoes/    # Sistema de avalia√ß√µes
‚îú‚îÄ‚îÄ equalizacao/   # Equaliza√ß√£o de resultados
‚îú‚îÄ‚îÄ IA/            # Integra√ß√£o com IA
‚îú‚îÄ‚îÄ rh/            # Relat√≥rios e analytics
‚îú‚îÄ‚îÄ projetos/      # Gest√£o de projetos
‚îú‚îÄ‚îÄ importacao/    # Importa√ß√£o de dados
‚îú‚îÄ‚îÄ auditoria/     # Logs de auditoria
‚îú‚îÄ‚îÄ sincronizacao/ # Sincroniza√ß√£o com ERP
‚îî‚îÄ‚îÄ common/        # Utilit√°rios compartilhados
```

### Scripts Dispon√≠veis
- `pnpm start`: Inicia o servidor
- `pnpm start:dev`: Modo desenvolvimento com hot reload
- `pnpm start:debug`: Modo debug
- `pnpm start:prod`: Modo produ√ß√£o
- `pnpm build`: Build do projeto
- `pnpm test`: Executa testes
- `pnpm lint`: Linting do c√≥digo
- `pnpm format`: Formata√ß√£o do c√≥digo

## üìä Banco de Dados

### Migra√ß√µes
```bash
# Criar nova migra√ß√£o
pnpm prisma migrate dev --name nome-da-migracao

# Aplicar migra√ß√µes em produ√ß√£o
pnpm prisma migrate deploy

# Reset do banco (desenvolvimento)
pnpm prisma migrate reset
```

### Seed e Popula√ß√£o de Dados
```bash
# Executar seed (importa dados de planilhas Excel)
pnpm prisma db seed

# Executar script SQL de popula√ß√£o (dados de teste)
psql -d rpe_db -f "SQL scripts/population.sql"
```

### Studio (Interface Visual)
```bash
# Abrir Prisma Studio
pnpm prisma studio
```

### Estrutura do Banco
O sistema utiliza PostgreSQL com as seguintes principais entidades:
- **Colaboradores**: Usu√°rios do sistema com diferentes perfis
- **Ciclos de Avalia√ß√£o**: Per√≠odos de avalia√ß√£o com status controlados
- **Crit√©rios**: M√©tricas avaliativas organizadas por pilares
- **Avalia√ß√µes**: Diferentes tipos de avalia√ß√£o (auto, pares, l√≠der, mentor)
- **Equaliza√ß√µes**: Ajustes de notas pelo comit√™
- **Projetos**: Gest√£o de projetos e aloca√ß√µes
- **Auditoria**: Logs de todas as a√ß√µes do sistema

## üîç Monitoramento e Logs

O sistema inclui:
- Logs de auditoria autom√°ticos
- Rastreamento de a√ß√µes dos usu√°rios
- Logs de sincroniza√ß√£o com ERP
- Monitoramento de performance

## üìÑ Licen√ßa

Este projeto est√° sob a licen√ßa UNLICENSED. Veja o arquivo `LICENSE` para mais detalhes.

## üìû Suporte

Para suporte e d√∫vidas:
- Abra uma issue no reposit√≥rio
- Entre em contato com a equipe de desenvolvimento

## üîÑ Changelog

Veja o arquivo `CHANGELOG.md` para hist√≥rico de mudan√ßas.

## üìÅ Estrutura de Arquivos

```
RPE-Backend/
‚îú‚îÄ‚îÄ src/                    # C√≥digo fonte
‚îÇ   ‚îú‚îÄ‚îÄ auth/              # Autentica√ß√£o e autoriza√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ colaborador/       # Gest√£o de colaboradores
‚îÇ   ‚îú‚îÄ‚îÄ ciclo/            # Ciclos de avalia√ß√£o
‚îÇ   ‚îú‚îÄ‚îÄ criterios/        # Crit√©rios avaliativos
‚îÇ   ‚îú‚îÄ‚îÄ avaliacoes/       # Sistema de avalia√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ equalizacao/      # Equaliza√ß√£o de resultados
‚îÇ   ‚îú‚îÄ‚îÄ IA/               # Integra√ß√£o com IA
‚îÇ   ‚îú‚îÄ‚îÄ rh/               # Relat√≥rios e analytics
‚îÇ   ‚îú‚îÄ‚îÄ projetos/         # Gest√£o de projetos
‚îÇ   ‚îú‚îÄ‚îÄ importacao/       # Importa√ß√£o de dados
‚îÇ   ‚îú‚îÄ‚îÄ auditoria/        # Logs de auditoria
‚îÇ   ‚îú‚îÄ‚îÄ sincronizacao/    # Sincroniza√ß√£o com ERP
‚îÇ   ‚îî‚îÄ‚îÄ common/           # Utilit√°rios compartilhados
‚îú‚îÄ‚îÄ prisma/               # Schema e migra√ß√µes do banco
‚îÇ   ‚îú‚îÄ‚îÄ migrations/       # Hist√≥rico de migra√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ seed.ts          # Script de seed
‚îÇ   ‚îî‚îÄ‚îÄ schema.prisma    # Schema do banco
‚îú‚îÄ‚îÄ SQL scripts/          # Scripts SQL adicionais
‚îÇ   ‚îî‚îÄ‚îÄ population.sql   # Popula√ß√£o inicial de dados
‚îú‚îÄ‚îÄ API.rest             # Cole√ß√£o de endpoints para teste
‚îú‚îÄ‚îÄ erp-db.json          # Mock do ERP para desenvolvimento
‚îú‚îÄ‚îÄ docker-compose.yml   # Configura√ß√£o Docker
‚îú‚îÄ‚îÄ Dockerfile           # Build da imagem Docker
‚îî‚îÄ‚îÄ package.json         # Depend√™ncias e scripts
```

## üîß Configura√ß√µes de Desenvolvimento

### Arquivos de Configura√ß√£o
- **`.env`**: Vari√°veis de ambiente (n√£o versionado)
- **`tsconfig.json`**: Configura√ß√£o TypeScript
- **`eslint.config.mjs`**: Regras de linting
- **`.prettierrc`**: Formata√ß√£o de c√≥digo
- **`commitlint.config.js`**: Valida√ß√£o de commits
- **`.gitignore`**: Arquivos ignorados pelo Git

### Scripts Dispon√≠veis
- **Desenvolvimento**: `pnpm start:dev`
- **Produ√ß√£o**: `pnpm start:prod`
- **Testes**: `pnpm test`, `pnpm test:watch`, `pnpm test:cov`
- **Linting**: `pnpm lint`, `pnpm format`
- **Banco**: `pnpm prisma studio`, `pnpm prisma migrate dev`
- **Docker**: `docker-compose up -d`

---

**RPE-Backend** - Sistema de Avalia√ß√£o de Desempenho Corporativo